generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Plant {
  id                 Int                  @id @default(autoincrement())
  custom_name        String               @db.VarChar(100)
  name               String               @db.VarChar(100)
  type               String               @db.VarChar(50)
  location           String               @db.VarChar(100)
  date_planted       DateTime             @db.Date
  last_pruning       DateTime             @map("last_prun") @db.Date
  last_water         DateTime             @db.Date
  last_fertilized    DateTime             @map("last_fertelized") @db.Date
  gen_data           Json
  botanical_name     String               @db.VarChar(50)
  pref_sun           Decimal              @db.Decimal(65, 2)
  pref_air_humidity  Decimal              @db.Decimal(65, 2)
  pref_soil_humidity Decimal              @db.Decimal(65, 2)
  health             Int                  @default(100)
  level              Int                  @default(1)
  xp                 Int                  @default(0)
  userId             Int                  @default(1) @map("user_id")
  last_interaction   DateTime             @default(now()) @map("last_interaction")
  user               User                 @relation(fields: [userId], references: [id])
  sensorData         SensorData[]
  growthHistory      PlantGrowthHistory[]
  statistics         PlantStatistics?
  images             PlantImage[]

  @@map("PLANT")
}

model PlantGrowthHistory {
  id        Int      @id @default(autoincrement())
  plantId   Int      @map("plant_id")
  timestamp DateTime @default(now()) @db.Timestamp(0)
  level     Int
  xp        Int
  health    Int
  plant     Plant    @relation(fields: [plantId], references: [id])

  @@map("PLANT_GROWTH_HISTORY")
}

model PlantStatistics {
  id                    Int   @id @default(autoincrement())
  plantId               Int   @unique @map("plant_id")
  total_water_count     Int   @default(0)
  total_fertilize_count Int   @default(0)
  total_prune_count     Int   @default(0)
  total_sensor_checks   Int   @default(0)
  plant                 Plant @relation(fields: [plantId], references: [id])

  @@map("PLANT_STATISTICS")
}

model SensorData {
  sensor_data_id  Int      @id @default(autoincrement())
  plant_id        Int
  timestamp       DateTime @db.Timestamp(0)
  temperature     Decimal  @db.Decimal(65, 2)
  humidity_air    Decimal  @db.Decimal(65, 2)
  light_intensity Decimal  @db.Decimal(65, 2)
  humidity_soil   Decimal  @map("Humidity_soil") @db.Decimal(65, 2)
  co2_amount      Decimal  @map("CO2_amount") @db.Decimal(65, 2)
  plant           Plant    @relation(fields: [plant_id], references: [id])

  @@index([plant_id])
  @@map("SENSOR_DATA")
}

model User {
  id           Int               @id @default(autoincrement())
  xp           Int               @default(0)
  level        Int               @default(1)
  email        String?           @unique @db.VarChar(255)
  name         String?           @db.VarChar(100)
  password     String?           @db.VarChar(255)
  plants       Plant[]
  achievements UserAchievement[]
  quests       UserQuest[]
  images       PlantImage[]

  @@map("USER")
}

model Achievement {
  id          Int               @id @default(autoincrement())
  name        String            @db.VarChar(100)
  description String            @db.VarChar(255)
  xp_reward   Int
  icon        String            @default("mdi-trophy")
  users       UserAchievement[]

  @@map("ACHIEVEMENT")
}

model UserAchievement {
  id            Int         @id @default(autoincrement())
  userId        Int         @map("user_id")
  achievementId Int         @map("achievement_id")
  earnedAt      DateTime    @default(now()) @map("earned_at")
  achievement   Achievement @relation(fields: [achievementId], references: [id])
  user          User        @relation(fields: [userId], references: [id])

  @@map("USER_ACHIEVEMENT")
}

model DailyQuest {
  id          Int         @id @default(autoincrement())
  name        String      @db.VarChar(100)
  description String      @db.VarChar(255)
  xp_reward   Int
  type        String      @db.VarChar(50)
  target      Int         @default(1)
  userQuests  UserQuest[]

  @@map("DAILY_QUEST")
}

model UserQuest {
  id           Int        @id @default(autoincrement())
  userId       Int        @map("user_id")
  questId      Int        @map("quest_id")
  currentValue Int        @default(0) @map("current_value")
  isCompleted  Boolean    @default(false) @map("is_completed")
  lastUpdated  DateTime   @updatedAt @map("last_updated")
  date         DateTime   @default(now()) @db.Date
  quest        DailyQuest @relation(fields: [questId], references: [id])
  user         User       @relation(fields: [userId], references: [id])

  @@unique([userId, questId, date])
  @@map("USER_QUEST")
}

model PlantImage {
  id         Int      @id @default(autoincrement())
  plantId    Int      @map("plant_id")
  userId     Int      @map("user_id")
  filename   String   @db.VarChar(255)
  url        String   @db.VarChar(255)
  uploadedAt DateTime @default(now()) @map("uploaded_at")
  caption    String?  @db.VarChar(255)
  plant      Plant    @relation(fields: [plantId], references: [id])
  user       User     @relation(fields: [userId], references: [id])

  @@map("PLANT_IMAGE")
}
